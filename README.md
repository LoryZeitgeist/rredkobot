# Telegram Image Preset Bot

Телеграм-бот, который отвечает на сообщения в групповом чате случайной картинкой из пресета.
Все необходимые настройки и конфигурация хранятся в `.env`, а пресеты описываются в JSON-файлах.

## Быстрый старт

1. Скопируйте `.env.example` в `.env` и заполните значения:
   - `BOT_TOKEN` — токен бота от @BotFather.
   - `ADMIN_IDS` — список Telegram ID администраторов через запятую.
   - `PRESETS_DIR` и `STATE_FILE` можно оставить по умолчанию.
2. Добавьте свои пресеты в папку `presets/` (пример — `presets/sample.json`).
3. Запустите контейнер:

```bash
docker compose up --build -d
```

Бот автоматически подключит тома `./presets` и `./data`, чтобы изменения сохранялись между перезапусками.

## Формат пресета

Каждый пресет — отдельный JSON-файл. Пример:

```json
{
  "name": "sample",
  "description": "Примерный пресет",
  "triggers": [
    {
      "phrase": "котики",
      "images": [
        "https://placekitten.com/400/400",
        "https://placekitten.com/500/500"
      ]
    }
  ]
}
```

- `phrase` — точный текст, который должны ввести в чате. Регистр не важен.
- `images` — список файлов внутри папки `presets` (например, `anya_redko/1.jpg`). Перед запуском положите реальные изображения в эту директорию, иначе бот не сможет их отправить.

## Алгоритм работы в чате

1. Назначьте пресет конкретному чату (см. админ-команды ниже).
2. Пользователи пишут фразу из пресета в групповом чате.
3. Бот выбирает случайную картинку из списка и отправляет ответ.

Если у триггера нет изображений или пресет не найден, бот ничего не ответит.

## Админ-команды

Команды работают **только** в личке с ботом и доступны пользователям из `ADMIN_IDS`:

- `/start` — краткая справка.
- `/spravka` — список доступных команд.
- `/spisok_presetov` — список доступных пресетов с описанием.
- `/obnovit_presets` — перечитать JSON-файлы из папки пресетов без перезапуска контейнера.
- `/naznachit_preset <chat_id> <preset_name>` — применить пресет к указанному чату. `chat_id` можно узнать, добавив бота в чат и посмотрев лог (или переслав сообщение бота себе и включив режим разработчика в Telegram).
- `/tekuschee_sostoyanie` — показать текущие назначения пресетов по чатам.

Все назначения сохраняются в `STATE_FILE` (по умолчанию `data/chat_presets.json`).

## Полезные команды Docker

```bash
docker compose logs -f        # Смотреть логи бота
 docker compose down           # Остановить контейнер
 docker compose up -d          # Запустить или перезапустить
```

Перед сборкой убедитесь, что папки `presets/` и `data/` существуют — они монтируются в контейнер для хранения файлов.

## Тестирование вне Docker

```bash
pip install -r requirements.txt
python bot.py
```

При локальном запуске настройки также считываются из `.env`.
